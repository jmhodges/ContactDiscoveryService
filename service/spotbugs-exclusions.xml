<FindBugsFilter>

  <Match>
    <!-- Caused by Java 11+ (until at least 13.0.2 at time of writing) generating a null check on try-with-resources.
     See <https://github.com/spotbugs/spotbugs/issues/756>. -->
    <Bug pattern="RCN_REDUNDANT_NULLCHECK_WOULD_HAVE_BEEN_A_NPE" />
  </Match>

  <Match>
    <!-- FIXME ignore temporarily -->
    <Bug pattern="DM_DEFAULT_ENCODING" />
  </Match>

  <Match>
    <Bug pattern="EI_EXPOSE_REP" />
    <Or>
      <!-- SgxRequestNegotiationResponse is the serialization class for enclave data. FIXME consider using a copy?  Are we already in the
              JNI code? -->
      <Class name="org.whispersystems.contactdiscovery.enclave.SgxRequestNegotiationResponse" />

      <!-- SgxsdMessage is a serialization class for enclave data. -->
      <Class name="org.whispersystems.contactdiscovery.enclave.SgxsdMessage" />

      <!-- DiscoveryRequest is a JSON serialization class. -->
      <Class name="org.whispersystems.contactdiscovery.entities.DiscoveryRequest" />

      <!-- DiscoveryResponse is a JSON serialization class. -->
      <Class name="org.whispersystems.contactdiscovery.entities.DiscoveryResponse" />

      <!-- RemoteAttestationRequest is a JSON serialization class. -->
      <Class name="org.whispersystems.contactdiscovery.entities.RemoteAttestationRequest" />

      <!-- RemoteAttestationResponse is a JSON serialization class. -->
      <Class name="org.whispersystems.contactdiscovery.entities.RemoteAttestationResponse" />
    </Or>
  </Match>

  <Match>
    <Bug pattern="EI_EXPOSE_REP2" />
    <Or>
      <!-- this is a json config class -->
      <Class name="org.whispersystems.contactdiscovery.entities.RemoteAttestationResponse" />
      
      <!-- the key field is a (private) byte array that is passed to
           SecretKeySpec. FIXME consider using a copy? -->
      <And>
        <Class name="org.whispersystems.contactdiscovery.auth.AuthorizationTokenVerifier" />
        <Field name="key" />
      </And>

      <And>
        <!-- these fields are passed to the JNI enclave code. FIXME consider using a copy? Are we already in the
        JNI code? -->
        <Class name="org.whispersystems.contactdiscovery.enclave.SgxEnclave" />
        <Or>
          <Field name="lastLaunchToken" />
          <Field name="spid"/>
        </Or>
      </And>

      <!-- SgxRequestNegotiationResponse is the serialization class for data coming from the enclave. FIXME
      consider using a copy? Are we already in the JNI code? -->
      <Class name="org.whispersystems.contactdiscovery.enclave.SgxRequestNegotiationResponse" />

      <!-- SgxsdMessage is a serialization class for enclave data. -->
      <Class name="org.whispersystems.contactdiscovery.enclave.SgxsdMessage" />

      <!-- DiscoveryRequest is a JSON serialization class. -->
      <Class name="org.whispersystems.contactdiscovery.entities.DiscoveryRequest" />

      <!-- DiscoveryResponse is a JSON serialization class. -->
      <Class name="org.whispersystems.contactdiscovery.entities.DiscoveryResponse" />

      <!-- RemoteAttestationRequest is a JSON serialization class. -->
      <Class name="org.whispersystems.contactdiscovery.entities.RemoteAttestationRequest" />

      <!-- RemoteAttestationResponse is a JSON serialization class. -->
      <Class name="org.whispersystems.contactdiscovery.entities.RemoteAttestationResponse" />
    </Or>
  </Match>

  <Match>
    <Bug pattern="URF_UNREAD_FIELD" />
    <!-- QuoteSignatureRequest is a JSON entity class and spotbugs doesn't see that it's serialized by javax.ws.rs.client.Entity.json. -->
    <Class name="org.whispersystems.contactdiscovery.client.QuoteSignatureRequest" />
  </Match>

  <Match>
    <!-- DirectoryProtos is a code generated by protobufs and not controllable. (The leading '~' makes this name param a
    Java regex.) -->
    <Class name="~org.whispersystems.contactdiscovery.directory.DirectoryProtos.*" />
  </Match>
</FindBugsFilter>
